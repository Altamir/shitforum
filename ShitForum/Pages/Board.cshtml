@page "{boardKey}"
@model ShitForum.Pages.BoardModel
@using ShitForum.ViewComponents
@inject ReCaptchaCore.RecaptchaSettings RecaptchaSettings
@{
    ViewData["Title"] = "Board";
}

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a asp-page="Index">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">@Model.Threads.Board.BoardName</li>
    </ol>
</nav>
<hr />
<form asp-page="Board" method="get">
    <input type="hidden" value="@Model.Threads.Board.Id" name="id" />
    <input placeholder="Search OPs..." name="filter" value="@Model.Filter" type="text" />
    <span>[<a asp-page="Catalog" asp-route-id="@Model.Threads.Board.Id">Catalog</a>]</span>
</form>
<hr />

@foreach (var thread in Model.Threads.Threads)
{
    <div class="row">
        <div class="col">
            @thread.OP.Name
            @thread.OP.Created
            No. <a asp-page="Thread" asp-route-boardKey="@Model.Threads.Board.BoardKey" asp-route-threadId="@thread.ThreadId" asp-route-subject="@thread.Subject">@thread.ThreadId</a>
        </div>
    </div>
    <div class="media">
        @if (thread.OP.File.HasValue)
        {
            <a asp-page="Thread" asp-route-boardKey="@Model.Threads.Board.BoardKey" asp-route-threadId="@thread.ThreadId" asp-route-subject="@thread.Subject">
                <img class="m-3" src="@Url.Action("GetPostThumbnail", "Images", new {id = thread.OP.Id})" />
            </a>
        }
        <div class="media-body">
            @if (!string.IsNullOrWhiteSpace(thread.Subject))
            {
                <p><a asp-page="Thread" asp-route-boardKey="@Model.Threads.Board.BoardKey" asp-route-threadId="@thread.ThreadId" asp-route-subject="@thread.Subject">@thread.Subject</a></p>
            }
            <p class="post-comment">@thread.OP.Comment</p>
        </div>
    </div>
    <div class="row">
        <div class="col">
            @($"{thread.PostCount} replies and {thread.ImageCount} images omitted.")
            <a asp-page="Thread" asp-route-boardKey="@Model.Threads.Board.BoardKey" asp-route-threadId="@thread.ThreadId">Click here</a> to view.
        </div>
    </div>
    @foreach (var p in thread.FinalPosts)
    {
        <div class="media post rounded mb-2">
            @if (p.File.HasValue)
            {
                <img class="m-3" src="@Url.Action("GetPostThumbnail", "Images", new {id = p.Id})" />
            }
            <div class="media-body">
                <p class="post-comment">@p.Comment</p>
            </div>
        </div>
    }
    <hr />
}
@await Component.InvokeAsync("Pager", new { pageNumber = Model.Threads.PageData.PageNumber, numberOfPages = Model.Threads.PageData.NumberOfPages })

<h5>Add a new thread</h5>

<div asp-validation-summary="All"></div>
<form id="post-form" method="post" enctype="multipart/form-data">
    <div class="form-group">Name: <input class="form-control" asp-for="Thread.Name" /></div>
    <div class="form-group">Options: <input class="form-control" asp-for="Thread.Options" /></div>
    <div class="form-group">Subject: <input class="form-control" asp-for="Thread.Subject" /></div>
    <div class="form-group">Comment: <textarea class="form-control" asp-for="Thread.Comment"></textarea></div>
    <div class="form-group">File: <input class="form-control" asp-for="Thread.File" type="file" /></div>
    <input asp-for="Thread.BoardId" type="hidden" />
    <button class="btn btn-primary g-recaptcha" data-callback="onSubmit" data-sitekey="@RecaptchaSettings.PublicKey">
        Post
    </button>
</form>
